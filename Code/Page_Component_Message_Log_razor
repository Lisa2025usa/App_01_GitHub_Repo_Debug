@* Updated: 2025-12-06 21:25 PST - Message log panel with header + consistent layout *@
@using TradingAppProject.Service.All
@implements IDisposable

<div class="test-panel-header">
    <h4>Message Log - System Messages</h4>
    <p class="test-panel-summary">
        Showing last @Var_Messages.Count messages.
    </p>
</div>

@if (Var_Messages.Count == 0)
{
    <div class="test-panel-empty">
        No messages yet.
    </div>
}
else
{
    <div class="test-panel-message-log">
        @foreach (var line in Var_Messages)
        {
            <div class="message-log-row">@line</div>
        }
    </div>
}

@code {
    [Inject] private Message_Service MessageService { get; set; } = default!;

    private List<string> Var_Messages = [];

    protected override void OnInitialized()
    {
        // Initial snapshot
        Var_Messages = [.. MessageService.Messages];

        // Subscribe for live updates
        MessageService.OnMessagesChanged += HandleMessagesChanged;
    }

    private void HandleMessagesChanged()
    {
        Var_Messages = [.. MessageService.Messages];
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        MessageService.OnMessagesChanged -= HandleMessagesChanged;
    }
}
