@* Updated: 2025-12-07 02:10 PST - Message log panel with shared test-panel styles *@

@using TradingAppProject.Service.All
@implements IDisposable

<div class="test-panel-header">
    <h4>Message Log - System Messages</h4>
    <p class="test-panel-summary">
        Showing last @Var_Messages.Count messages.
    </p>
</div>

@if (Var_Messages.Count == 0)
{
    <div class="test-panel-empty">
        No messages yet.
    </div>
}
else
{
    <div class="test-panel-message-log">
        @foreach (string line in Var_Messages)
        {
            <div class="test-panel-message-log-row">@line</div>
        }
    </div>
}

@code
{
    [Inject] private Message_Service MessageService { get; set; } = default!;

    private List<string> Var_Messages { get; set; } = [];

    protected override void OnInitialized()
    {
        Var_Messages = [.. MessageService.Messages];
        MessageService.OnMessagesChanged += HandleMessagesChanged;
    }

    private void HandleMessagesChanged()
    {
        Var_Messages = [.. MessageService.Messages];
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        MessageService.OnMessagesChanged -= HandleMessagesChanged;
    }
}
